<?xml version="1.0" encoding="utf-8"?>
<mx:Application creationComplete="questions.send()" xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical" height="320" width="200" horizontalScrollPolicy="off" viewSourceURL="srcview/index.html" backgroundAlpha="0" verticalScrollPolicy="off" maxWidth="200" maxHeight="350" paddingBottom="4" paddingLeft="10" paddingRight="10" paddingTop="4">
		
	<mx:HTTPService id="questions" url="http://tanga.com/questions/current" result="question_handler(event)" />
	
	<mx:Script>
		<![CDATA[
			import mx.utils.ObjectProxy;
			import mx.rpc.events.ResultEvent;
			import mx.collections.ArrayCollection;
			import mx.controls.*;
			
			[Bindable]
			public var question:String;
			
			[Bindable]
			public var times_answered:int;
			
			[Bindable]
			public var answers:ArrayCollection;
			
			private var question_id:int;
			
			public function question_handler(evt:ResultEvent):void
			{
				question_id = evt.result.question.id;
				times_answered = evt.result.question.times_answered;
				question = evt.result.question.body;
				answers = evt.result.question.answers.answer;
			}
			
			public function question_answered(evt:Event):void
			{
				var answer:Object = evt.target.getRepeaterItem();
				var service:HTTPService = new HTTPService();
				service.url = "http://tanga.com/random/questions/" + question_id + "/question_answers.xml?answer=" + answer.id;
				service.request = { _method: "POST" };  // Why do I have to do this?
				service.method = "POST";                // This doesn't seem to submit a POST, just a GET.
				service.send();
				questions.send();
			}
		]]>
	</mx:Script>
	
	<mx:Label text="Tanga Random Questions" color="#D6D430" fontSize="12"/>
	<mx:TextArea text="{question}" color="#18C5EA" editable="false" textAlign="center" backgroundAlpha="0" borderThickness="0" />
	<mx:Label text="{times_answered} answers so far" color="#D6D430" fontSize="8"/>
	
	<mx:VBox height="100%" borderSides="10">
	 	<mx:Repeater id="question_repeater" dataProvider="{answers}">
	 		<mx:Button label="{question_repeater.currentItem.body}" click="question_answered(event)" color="#11EF64" alpha="0.1" textRollOverColor="#ECD50F"/>
	 	</mx:Repeater>
	</mx:VBox>
	
</mx:Application>
